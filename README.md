# Документация по проекту "Система автоматизированного сканирования портов"

## Описание проекта
Проект ревлизован на основании open-source утилиты Masscan и языка программирования Python.
Предназначен для сканирования портов на целевых серверах, анализ результатов и отправка уведомлений в Telegram.

## Задачи проекта
Задачей проекта является:
- Выполнять многопоточное сканирование адресов.
- Определять открытые порты
- Проводить анализ баннеров
- Проверять историю обнаружение портов, на выявление был ли этот порт открыт ранее, либо изменение баннеров.
- Уведомление о событиях

## Стек используемых технологий
- masscan 1.3.2
- Python3.12
- python-nmap
- Telegram BOT

## Архитектура системы

Система построена на основе:

- **Config** - загрузка и управление конфигурацией
- **MasscanScanner** - сканирование портов с помощью Masscan
- **BannerGrabber** - определение сервисов на портах с помощью Nmap
- **ScanHistory** - ведение истории сканирований и обнаружение изменений
- **TelegramNotifier** - отправка уведомлений через Telegram API
- **PortScannerOrchestrator** - координация всех компонентов
- **setup_logging** - конфигурирование логирования
- **main** - точка входа программы

## Установка и подготовка

### 1. Клонирование репозитория и установка зависимостей Python

```bash
git clone https://github.com/GarussMisha/VK_masscan.git
cd ./VK_masscan
pip install -r requirements.txt
```

Требуемые библиотеки:
- python-telegram-bot
- python-nmap
- python-dotenv
- requests

### 2. Установка пакетов Linux для сканирования

```bash
sudo apt update
sudo apt install -y masscan
```

### 3. Конфигурирование

Создать файл `.env` в корневой папке:

```bash
TELEGRAM_API_TOKEN=ваш_токен_бота
TELEGRAM_CHAT_ID=ваш_id_чата
```

Токен можно получить через @BotFather в Telegram.
Chat ID можно узнать отправив любое сообщение боту и выполнив запрос к API.

### 4. Конфигурирование целей сканирования

Отредактировать файл `app/config.json` для добавления целей сканирования.

## Использование

### Разовое сканирование

Установить в `config.json`:
```json
"schedule": {
  "enabled": false
}
```

Затем запустить:
```bash
sudo python3 app/masscan_scaner.py
```

Программа выполнит одно сканирование всех целей и завершится.

### Периодическое сканирование

Установить в `config.json`:
```json
"schedule": {
  "enabled": true,
  "interval_hours": 0.25
}
```

Затем запустить:
```bash
sudo python3 app/masscan_scaner.py
```

Программа будет выполнять сканирование каждые 0.25 часа (15 минут).
Для остановки нажать Ctrl+C.

## Логирование

Все события логируются в файл `scan.log` и выводятся в консоль.

Основные события:
- Начало и завершение сканирования
- Обнаруженные открытые порты
- Определенные сервисы
- Отправленные уведомления
- Ошибки и исключения

## Результаты

История сканирований сохраняется в файле `app/scan_history/scan_history.json`.

Формат истории:
```json
{
  "IP_АДРЕС": {
    "first_scanned": "дата первого сканирования",
    "ports": [список открытых портов],
    "services": {
      "номер_порта": "название сервиса и версия"
    },
   "last_scanned": "дата последнего сканирования",
  }
}
```

